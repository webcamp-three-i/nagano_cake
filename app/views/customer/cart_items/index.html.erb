<h2>ショッピングカート</h2>

<table>
  <thead>
    <th>商品名</th>
    <th>単価(税込)</th>
    <th>数量</th>
    <th>小計</th>
    <th></th>
  </thead>
  <tbody>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tbody>
</table>

<div class="col-lg-10 offset-lg-1 space">
  <div class="container-fluid">
    <!-- タイトルと全消去ボタン -->
    <div class="row">
      <div class="col-lg-4">
        <h2>ショッピングカート</h2>
      </div>
      <div class="col-lg-4">
        <%= link_to 'カートを空にする', destroy_all_customer_cart_items_path, method: :delete, class: 'btn btn-danger' %>
      </div>
    </div>

    <!-- カート内の商品一覧 -->
    <div class="d-none d-lg-block">
      <div class="row space">
        <div class="col-lg-5"><h4>商品名</h4></div>
        <div class="col-lg-2"><h4>単価（税込）</h4></div>
        <div class="col-lg-2"><h4>数量</h4></div>
        <div class="col-lg-2"><h4>小計</h4></div>
      </div>
    </div>

    <% sum_all = 0 %> <!--合計金額の初期値を0として定義-->
    <% @cart_items.each do |cart_item| %>
    <div class="row space-sm">

      <!--カート内の商品写真-->
      <div class="col-lg-3">
        <%= link_to product_path(cart_item.product) do %>
        <%= attachment_image_tag(cart_item.product, :image, :fill, 100, 100, fallback: "no_img.jpg") %>
        <% end %>
      </div>

      <!--カート内の商品名-->
      <div class="col-lg-2">
        <%= link_to product_path(cart_item.product) do %>
        <%= cart_item.product.name %>
        <% end %>
      </div>

      <!--カート内の単価(税込)-->
      <div class="col-lg-2">
        <!--ヘルパーで定義した税込価格を表示。引数にカートに紐づいた商品の税別価格。-->
        <%= price_include_tax(cart_item.product.price_without_tax) %> 
      </div>

      <!--カート内商品の--数量変更-->
      <div class="col-lg-2">
        <%= form_with model: cart_item, local: true do |f| %> 
        <%= f.number_field :quantity, value: cart_item.quantity, min:1, max:99  %>
        <%= f.submit "変更", class: "btn btn-primary" %>
        <% end %>
      </div>

      <!--カート内の小計-->
      <div class="col-lg-2">
        <%= sum_product = price_include_tax(cart_item.product.price_without_tax).to_i * cart_item.quantity %>
        <% sum_all += sum_product %>
      </div>

      <!--カート内商品の削除-->
      <div class="col-lg-1">
        <%= link_to "削除する", customer_cart_item_path(cart_item), method: :delete, class: "btn btn-danger"%>
      </div>
    </div>
    <% end %>

    <!-- 合計金額と情報入力 -->
    <div class="row space">
      <div class="col-lg-2 offset-lg-7 space-sm">
        <%= link_to "買い物を続ける", customer_products_path, class: "btn btn-danger "%>
      </div>
      <div class="col-lg-3 space-sm">
        <div class="row">
          <h4>合計金額：<%= sum_all %></h4>
        </div>
      </div>
    </div>
    <div class="row space">
      <div class="col-lg-3 offset-lg-9">
        <%= link_to "情報入力に進む", new_customer_order_path, class: "btn btn-danger btn-lg" %>
      </div>
    </div>

  </div>
</div>